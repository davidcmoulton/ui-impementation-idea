@use 'sass:map';
@use 'settings';
@use 'aesthetic';

// FUNCTIONS

@function getMenuConfig($state) {
  $config: ();
  @if $state == 'show' {
    $config: (
      'container-margin-left': 0,
      'menu-translateX': 0,
      'menu-links-display': unset,
    )
  } @else if $state == 'hide' {
    $config: (
      'container-margin-left': settings.$flyout-menu-offscreen-offset,
      'menu-translateX': settings.$flyout-menu-offscreen-offset,
      'menu-links-display': none,
    )
  }
  @return $config;
}

// MIXINS

@mixin flip-menu($state) {
  margin-left: map.get(getMenuConfig($state), 'container-margin-left');

  .fly-out-menu {
    transform: translateX(map.get(getMenuConfig($state), 'menu-translateX'));

    li,
    // Extra specifificty to override .fly-out-menu__footer styles
    footer.fly-out-menu__footer {
      display:  map.get(getMenuConfig($state), 'menu-links-display');
    }
  }
}

@mixin hide-menu() {
  @include flip-menu(hide);
}

@mixin show-menu() {
  @include flip-menu(show);
}

@mixin transition($property) {
  transition: $property settings.$transition-duration settings.$timing-function;
}

// Set content on this for screen reader to announce menu toggle stuff
@mixin label-toggle-as($label-state) {
  & .fly-out-toggle::before {
    @include aesthetic.visually-hidden();
    content: '#{$label-state} the following menu';
  }
}

@mixin label-toggle-to-show-menu() {
  @include label-toggle-as('Show');
}

@mixin label-toggle-to-hide-menu() {
  @include label-toggle-as('Hide');
}

// STYLE RULES

.page-container {
  @include transition(margin-left);
}

.fly-out-menu {
  @include transition(transform);

  &::before {
    @include aesthetic.visually-hidden();
    display: block;
  }
}

// Show / hide logic

// The viewport is narrow and the user hasn't interacted with the menu control yet, or the user has dismissed the menu
.page-container:not(.page-container--menu),
.page-container[data-menu-shown="false"] {
  @include hide-menu();
  @include label-toggle-to-show-menu();
}

// The user has invoked the menu
.page-container[data-menu-shown="true"] {
  @include show-menu();
  @include label-toggle-to-hide-menu();
}

// The viewport is wide and the user hasn't dismissed the menu
.page-container:not([data-menu-shown="false"]) {
    @media screen and (min-width: settings.$breakpoint) {
      @include show-menu();
      @include label-toggle-to-hide-menu();
    }
}
